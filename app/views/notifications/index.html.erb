<!-- Modern Notifications Page -->
<div class="notifications-page" data-controller="notification-interactions">
  <div class="w-full max-w-6xl mx-auto px-4 py-6">
    
    <!-- Header Section with Stats -->
    <div class="mb-8">
      <div class="notification-card overflow-hidden">
        <!-- Gradient Header -->
        <div class="notification-header px-8 py-12">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
            <div class="mb-6 lg:mb-0">
              <div class="flex items-center mb-4">
                <div class="notification-stats-card p-3 rounded-xl mr-4">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 3h16a2 2 0 012 2v6M4 3a2 2 0 00-2 2v6h2V5h16v6h2V5a2 2 0 00-2-2H4z"/>
                  </svg>
                </div>
                <div>
                  <h1 class="text-4xl font-bold text-white mb-2">Notifications</h1>
                  <p class="text-green-100 text-lg">Stay up to date with your forum activity</p>
                </div>
              </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 gap-4 lg:gap-6">
              <div class="notification-stats-card rounded-xl p-4 text-center">
                <div class="text-2xl lg:text-3xl font-bold text-white mb-1">
                  <%= @notifications.unread.count %>
                </div>
                <div class="text-xs lg:text-sm text-green-100 font-medium">Unread</div>
              </div>
              <div class="notification-stats-card rounded-xl p-4 text-center">
                <div class="text-2xl lg:text-3xl font-bold text-white mb-1">
                  <%= @notifications.count %>
                </div>
                <div class="text-xs lg:text-sm text-green-100 font-medium">Total</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="px-8 py-6 border-b border-gray-100 bg-gray-50">
          <div class="flex flex-col sm:flex-row gap-3 sm:justify-between sm:items-center">
            <div class="flex flex-wrap gap-3">
              <% if @notifications.unread.any? %>
                <%= form_with url: mark_all_as_read_notifications_path, method: :post, local: false, class: "inline-block" do |f| %>
                  <%= f.submit "Mark All as Read", 
                      class: "gradient-button",
                      data: { 
                        disable_with: "Marking...",
                        action: "mark-all-as-read"
                      } %>
                <% end %>
              <% end %>
              
              <%= form_with url: clear_notifications_path, method: :delete, local: false, class: "inline-block", 
                  data: { 
                    confirm: "⚠️ This will permanently delete all your notifications. Are you sure?",
                    action: "clear-all"
                  } do |f| %>
                <%= f.submit "Clear All", 
                    class: "gradient-button-red",
                    data: { disable_with: "Clearing..." } %>
              <% end %>
            </div>
            
            <!-- Filter Buttons -->
            <div class="flex bg-white rounded-xl shadow-inner border border-gray-200 p-1">
              <button onclick="showAllNotifications()" id="btn-all" class="notification-filter-btn active px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200">
                All
              </button>
              <button onclick="showUnreadNotifications()" id="btn-unread" class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200">
                Unread
              </button>
              <button onclick="showReadNotifications()" id="btn-read" class="notification-filter-btn px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200">
                Read
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Notifications Content -->
    <div class="notification-card overflow-hidden">
      <% if @notifications.any? %>
        <!-- Unread Notifications -->
        <div id="unread-section" class="notification-section">
          <% if @notifications.unread.any? %>
            <div class="section-header">
              <div class="flex items-center">
                <div class="w-3 h-3 bg-orange-400 rounded-full mr-3 animate-pulse"></div>
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                  <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Unread Notifications
                  <span class="ml-2 px-3 py-1 bg-orange-100 text-orange-800 text-sm font-semibold rounded-full">
                    <%= @notifications.unread.count %>
                  </span>
                </h2>
              </div>
            </div>
            <div class="divide-y divide-gray-100">
              <%= render 'notifications/notifications', notifications: @notifications.unread, section: 'unread' %>
            </div>
          <% end %>
        </div>
        
        <!-- Read Notifications -->
        <div id="read-section" class="notification-section">
          <% if @notifications.read.any? %>
            <div class="section-header read-section">
              <div class="flex items-center">
                <div class="w-3 h-3 bg-green-400 rounded-full mr-3"></div>
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                  <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  Read Notifications
                  <span class="ml-2 px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded-full">
                    <%= @notifications.read.count %>
                  </span>
                </h2>
              </div>
            </div>
            <div class="divide-y divide-gray-100">
              <%= render 'notifications/notifications', notifications: @notifications.read, section: 'read' %>
            </div>
          <% end %>
        </div>
      <% else %>
        <!-- Empty State -->
        <div class="px-8 py-16 text-center">
          <div class="max-w-md mx-auto">
            <div class="mb-8">
              <div class="mx-auto w-24 h-24 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full flex items-center justify-center mb-6">
                <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                </svg>
              </div>
              <h3 class="text-2xl font-bold text-gray-800 mb-4">No notifications yet!</h3>
              <p class="text-gray-600 mb-8 leading-relaxed">
                When you receive likes, comments, mentions, or follows, they'll appear here. 
                Start engaging with the community to see your notifications come to life!
              </p>
              <%= link_to "Explore Posts", root_path, 
                  class: "inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200" %>
            </div>
          </div>
        </div>
      <% end %>
      
      <!-- Pagination -->
      <% if @notifications.respond_to?(:current_page) && @notifications.total_pages > 1 %>
        <div class="px-8 py-6 border-t border-gray-100 bg-gray-50">
          <div class="flex items-center justify-between pagination-controls">
            <div class="text-sm text-gray-600 pagination-info">
              Showing page <%= @notifications.current_page %> of <%= @notifications.total_pages %>
              (<%= @notifications.total_count %> total notifications)
            </div>
            <div class="flex space-x-2 pagination-buttons">
              <% if @notifications.prev_page %>
                <%= link_to notifications_path(page: @notifications.prev_page), 
                    class: "inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors duration-200" do %>
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                  Previous
                <% end %>
              <% else %>
                <span class="inline-flex items-center px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg text-sm font-medium text-gray-400 cursor-not-allowed">
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                  Previous
                </span>
              <% end %>
              
              <% if @notifications.next_page %>
                <%= link_to notifications_path(page: @notifications.next_page), 
                    class: "inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors duration-200" do %>
                  Next
                  <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                <% end %>
              <% else %>
                <span class="inline-flex items-center px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg text-sm font-medium text-gray-400 cursor-not-allowed">
                  Next
                  <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- JavaScript for Filtering -->
<script>
function showAllNotifications() {
  document.querySelectorAll('.notification-section').forEach(section => {
    section.style.display = 'block';
  });
  updateActiveFilter('btn-all');
}

function showUnreadNotifications() {
  document.getElementById('unread-section').style.display = 'block';
  document.getElementById('read-section').style.display = 'none';
  updateActiveFilter('btn-unread');
}

function showReadNotifications() {
  document.getElementById('unread-section').style.display = 'none';
  document.getElementById('read-section').style.display = 'block';
  updateActiveFilter('btn-read');
}

function updateActiveFilter(activeId) {
  document.querySelectorAll('.notification-filter-btn').forEach(btn => {
    btn.classList.remove('active');
    btn.classList.remove('bg-green-600', 'text-white', 'shadow-md');
    btn.classList.add('text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
  });
  
  const activeBtn = document.getElementById(activeId);
  activeBtn.classList.add('active', 'bg-green-600', 'text-white', 'shadow-md');
  activeBtn.classList.remove('text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  updateActiveFilter('btn-all');
  
  // Update notification badges when page loads
  const controller = document.querySelector('[data-controller~="notification-badge"]');
  if (controller && controller.notificationBadgeController) {
    // Update badge count to 0 since user is viewing notifications
    controller.notificationBadgeController.updateBadgeCount(0);
  } else {
    // Fallback: dispatch event to update badges
    document.dispatchEvent(new CustomEvent('notifications:viewed'));
  }
  
  // Listen for form submissions that affect notification count
  document.addEventListener('submit', function(event) {
    const form = event.target;
    
    // Handle mark all as read
    if (form.action && form.action.includes('mark_all_as_read')) {
      setTimeout(() => {
        document.dispatchEvent(new CustomEvent('notifications:markAllRead'));
      }, 100);
    }
    
    // Handle clear all
    if (form.action && form.action.includes('clear')) {
      setTimeout(() => {
        document.dispatchEvent(new CustomEvent('notifications:cleared'));
      }, 100);
    }
    
    // Handle individual mark as read
    if (form.action && form.action.includes('mark_as_read')) {
      setTimeout(() => {
        // Fetch updated count from server
        fetch('/notifications.json')
          .then(response => response.json())
          .then(data => {
            const unreadCount = data.filter(n => !n.read).length;
            document.dispatchEvent(new CustomEvent('notifications:updated', {
              detail: { count: unreadCount }
            }));
          })
          .catch(error => console.error('Error updating notification count:', error));
      }, 100);
    }
  });
});
</script>

<!-- Custom Styles -->
<style>
/* Ensure all elements have proper colors */
.notifications-page {
  background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
  min-height: 100vh;
}

.notification-header {
  background: linear-gradient(135deg, #16a34a 0%, #15803d 50%, #14532d 100%);
  color: white;
}

.notification-stats-card {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
}

.notification-card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 1rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.notification-item {
  border-bottom: 1px solid #f3f4f6;
  transition: all 0.2s ease;
}

.notification-item:hover {
  background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
}

.unread-indicator {
  background: linear-gradient(135deg, #16a34a, #15803d);
}

.notification-filter-btn {
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  font-weight: 500;
  transition: all 0.2s ease;
  color: #6b7280;
}

.notification-filter-btn:hover {
  background-color: #f3f4f6;
  color: #374151;
}

.notification-filter-btn.active {
  background: linear-gradient(135deg, #16a34a, #15803d);
  color: white;
  box-shadow: 0 2px 4px rgba(22, 163, 74, 0.3);
}

.action-button {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.2s ease;
  border: none;
  cursor: pointer;
}

.action-button-view {
  background-color: #f0fdf4;
  color: #16a34a;
}

.action-button-view:hover {
  background-color: #dcfce7;
  color: #15803d;
}

.action-button-read {
  background-color: #f0fdf4;
  color: #16a34a;
}

.action-button-read:hover {
  background-color: #dcfce7;
  color: #15803d;
}

.action-button-delete {
  background-color: #fef2f2;
  color: #dc2626;
}

.action-button-delete:hover {
  background-color: #fee2e2;
  color: #b91c1c;
}

.gradient-button {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  padding: 0.625rem 1rem;
  border-radius: 0.75rem;
  font-weight: 600;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
  border: none;
  cursor: pointer;
}

.gradient-button:hover {
  background: linear-gradient(135deg, #059669, #047857);
  transform: translateY(-1px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.gradient-button-red {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color: white;
  padding: 0.625rem 1rem;
  border-radius: 0.75rem;
  font-weight: 600;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
  border: none;
  cursor: pointer;
}

.gradient-button-red:hover {
  background: linear-gradient(135deg, #dc2626, #b91c1c);
  transform: translateY(-1px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.section-header {
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  border-left: 4px solid #f59e0b;
  padding: 1.5rem;
}

.section-header.read-section {
  background: linear-gradient(135deg, #dcfdf7, #a7f3d0);
  border-left: 4px solid #10b981;
}

/* Responsive adjustments for pagination */
@media (max-width: 640px) {
  .pagination-controls {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .pagination-info {
    order: 2;
  }
  
  .pagination-buttons {
    order: 1;
    justify-content: center;
  }
}

/* Force color application */
.text-green-600 { color: #16a34a !important; }
.text-blue-600 { color: #2563eb !important; }
.text-red-600 { color: #dc2626 !important; }
.text-yellow-600 { color: #ca8a04 !important; }
.text-gray-700 { color: #374151 !important; }
.text-gray-600 { color: #4b5563 !important; }
.text-gray-500 { color: #6b7280 !important; }
.text-white { color: #ffffff !important; }

.bg-green-50 { background-color: #f0fdf4 !important; }
.bg-red-50 { background-color: #fef2f2 !important; }
.bg-white { background-color: #ffffff !important; }

/* Hover states */
.hover\:bg-green-100:hover { background-color: #dcfce7 !important; }
.hover\:bg-blue-100:hover { background-color: #dbeafe !important; }
.hover\:bg-red-100:hover { background-color: #fee2e2 !important; }
</style>
